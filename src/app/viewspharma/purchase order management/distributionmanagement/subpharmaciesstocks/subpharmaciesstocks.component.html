<div class="form-meta">
  <!-- <p>pharmamanagementlist works!</p> -->

  <div class="header">
    <h2>{{ pharmacyDetails?.name || "MEDICINE" }} Stock LIST</h2>
    <div class="">
      <!-- <button class="list-cases-btn mx-3"   ><i class="fa-solid fa-user-group"></i></button> -->
      <!-- <button
        class="list-cases-btn mx-3"
        [routerLink]="['/pharmalayout/pharmamanagement']"
        routerLinkActive="router-link-active"
      >
        ADD MEDICINE
      </button> -->
      <button class="list-cases-btn mx-3" (click)="toggleLowStockView()">
        {{ showingLowStock ? "Show All Medicines" : "Stock About to Finish" }}
        <span *ngIf="!showingLowStock" class="badge bg-danger ms-2">
          {{ lowStockMedicinesFullList.length }}
        </span>
      </button>
      <!-- <button class="list-cases-btn mx-3" (click)="toggleLowStockView()">
  Stock About to Finish
  <span *ngIf="!showingLowStock" class="badge bg-danger ms-2">
    {{ lowStockMedicinesFullList.length }}
  </span>
</button> -->
    </div>
  </div>

  <div class="top-bar p-3">
    <form [formGroup]="filterForm" class="top-bar p-3">
      <input type="text" placeholder="Search..." formControlName="searchText" />
    </form>
  </div>

  <div class="table-responsive">
    <table
      class="table table-bordered table-hover align-middle diagnosis-table"
    >
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Medicine Name</th>
          <th>Supplier</th>
          <!-- <th>Dose</th>   -->
          <th>Expiry Date</th>
          <th>Manufacturing Date</th>
          <th>Stock</th>
          <th>Price</th>
          <!-- <th>Actions</th> -->
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let medicine of showingLowStock ? lowStockMedicines : medicines;
            let i = index
          "
          [ngClass]="{
            'table-danger': isExpired(medicine),
            'table-warning': !isExpired(medicine) && isNearExpiry(medicine, 30)
          }"
        >
          <td>{{ i + 1 }}</td>
          <td>{{ medicine.medicine_name }}</td>

          <!-- supplier comes from first batch -->
          <td>{{ medicine?.batch_details[0]?.supplier || "N/A" }}</td>

          <!-- dose might be in medicine object, fallback to N/A -->
          <!-- <td>{{ medicine?.medicine?.dose || "N/A" }}</td> -->

          <td>
            {{ medicine?.batch_details[0]?.expiry_date | date : "dd-MM-yyyy" }}
          </td>
          <td>
            {{ medicine?.batch_details[0]?.mfg_date | date : "dd-MM-yyyy" }}
          </td>

          <td>
            {{ medicine.current_stock }}
            <span
              *ngIf="medicine.current_stock <= 10"
              class="badge bg-danger ms-2"
            >
              Only {{ medicine.current_stock }} left
            </span>
          </td>

          <!-- price is also in first batch -->
          <td>
            {{
              medicine?.medicine?.price ||
                medicine?.batch_details[0]?.unit_price ||
                "N/A"
            }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- <table class="table table-bordered">
 <thead class="table-dark text-center" >
    <tr>
      <th>Medicine Name</th>
      <th>Supplier</th>
      <th>Dose</th>
      <th>Expiry Date</th>
      <th>Manufacturing Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let medicine of medicines">
      <td>{{ medicine.medicine_name }}</td>
      <td>{{ medicine.supplier }}</td>
      <td>{{ medicine.dose }}</td>
      <td>{{ medicine.expiry_date | date:'dd-MM-yyyy' }}</td>
      <td>{{ medicine.mfg_date | date:'dd-MM-yyyy' }}</td>
      <td>
        <i class="fa-solid fa-pencil action-btn" (click)="editmedicine(medicine._id)"></i>
        <i class="fa-solid fa-trash action-btn"  (click)="deletemedicine(medicine._id)"></i>

      </td>
    </tr>
  </tbody>
</table> -->
  <div class="pagination">
    <button
      class="pagination-btn"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>
    Page {{ currentPage }} of {{ totalPages }}
    <button
      class="pagination-btn"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>
</div>
