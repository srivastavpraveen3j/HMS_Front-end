<div class="form-meta">
  <div class="header">
    <h2>Material Request List</h2>
    <button
      class="list-cases-btn"
      [routerLink]="['/inventorylayout/purchaserequest']"
      routerLinkActive="router-link-active"
      *ngIf="userPermissions.create">
      ADD NEW REQUEST
    </button>
  </div>

  <!-- ✅ Updated Date Filter Section -->
  <div class="filters d-flex align-items-center mb-3">
    <label class="m-3">
      <input
        type="radio"
        name="filter"
        value="today"
        [(ngModel)]="activeFilter"
        (change)="applyFilters()"
      />
      TODAY'S
    </label>

    <label class="m-3">
      <input
        type="radio"
        name="filter"
        value="dateRange"
        [(ngModel)]="activeFilter"
        (change)="applyFilters()"
      />
      Date Range
    </label>

    <!-- Date Inputs Visible Only for Date Range -->
    <input
      *ngIf="activeFilter === 'dateRange'"
      type="date"
      [(ngModel)]="startDate"
      (change)="applyFilters()"
      class="form-control mx-2"
      style="width: auto;"
    />
    <input
      *ngIf="activeFilter === 'dateRange'"
      type="date"
      [(ngModel)]="endDate"
      (change)="applyFilters()"
      class="form-control mx-2"
      style="width: auto;"
    />
  </div>

  <!-- Tabs -->
  <div class="tab-bar">
    <div
      class="tab"
      *ngFor="let status of statuses; let i = index"
      (click)="onTabClick(status, i)"
      [ngClass]="{'active-tab': selectedStatus === status}">
      {{ status }}
    </div>
    <div class="tab-underline" [style.transform]="'translateX(' + activeTabIndex * 100 + '%)'"></div>
  </div>

  <!-- ✅ Updated No Data Message -->
  <div *ngIf="requisitions.length === 0" class="alert alert-warning text-center mt-3">
    <ng-container *ngIf="activeFilter === 'today'">
      No {{ selectedStatus }} requisitions found for today.
    </ng-container>
    <ng-container *ngIf="activeFilter === 'dateRange'">
      No {{ selectedStatus }} requisitions found for the selected date range.
    </ng-container>
  </div>

  <!-- Rest of your existing table and card views remain the same -->
  <!-- TABLE VIEW -->
  <table class="table table-bordered table-hover align-middle diagnosis-table"
         *ngIf="userPermissions.read && !userMaterialreApproval.read && requisitions.length > 0">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Department</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Category</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pr of requisitions; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ pr.departmentName }}</td>
        <td>{{ pr.itemName }}</td>
        <td>{{ pr.quantityRequired }}</td>
        <td>{{ pr.category }}</td>
        <td>
          <span class="badge bg-secondary" *ngIf="pr.status === 'Draft'">Draft</span>
          <span class="badge bg-warning" *ngIf="pr.status === 'Submitted'">Submitted</span>
          <span class="badge bg-success" *ngIf="pr.status === 'Approved'">Approved</span>
          <span class="badge bg-danger" *ngIf="pr.status === 'Rejected'">Rejected</span>
        </td>
        <td>
          <i class="fa-solid fa-pencil action-btn"
             *ngIf="userPermissions.update && pr.status !== 'Approved' && pr.status !== 'Rejected'"
             (click)="editrequest(pr._id)"></i>
          <i class="fa-solid fa-trash action-btn"
              *ngIf="userPermissions.delete && pr.status !== 'Approved' && pr.status !== 'Rejected'"
             (click)="deleterequest(pr._id)"></i>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- CARD VIEW -->
  <div class="row p-5" *ngIf="userPermissions.read && userMaterialreApproval.read && requisitions.length > 0">
    <div class="col-md-6 mb-4" *ngFor="let pr of requisitions; let i = index">
      <div class="card shadow rounded-3 border-0">
        <!-- Card Header -->
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center rounded-top">
          <div class="fw-bold">{{ pr.materialRequestNumber}} - {{ pr.departmentName }}</div>
          <span>
           Material Request Date : {{pr.createdAt | date}}
          </span>
          <span class="badge rounded-pill px-3 py-2 text-uppercase"
                [ngClass]="{
                  'bg-secondary': pr.status === 'Draft',
                  'bg-warning text-dark': pr.status === 'Submitted',
                  'bg-success': pr.status === 'Approved',
                  'bg-danger': pr.status === 'Rejected'
                }">
            {{ pr.status }}
          </span>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-6"><strong>  Item:</strong> {{ pr.itemName }}</div>
            <div class="col-6"><strong>  Quantity:</strong> {{ pr.quantityRequired }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>  Category:</strong> {{ pr.category }}</div>
            <div class="col-6" *ngIf="pr.createdByUser">
              <strong>   Requested By:</strong> {{ pr.createdByUser.name }}
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer bg-light d-flex justify-content-between align-items-center">
          <!-- Action Buttons -->
          <div>
            <i class="fa-solid fa-pencil text-primary me-3 fs-5 cursor-pointer"
               *ngIf="userPermissions.update && pr.status !== 'Approved' && pr.status !== 'Rejected'"
               (click)="editrequest(pr._id)"></i>

            <i class="fa-solid fa-trash text-danger fs-5 cursor-pointer"
               *ngIf="userPermissions.delete && pr.status !== 'Approved' && pr.status !== 'Rejected'"
               (click)="deleterequest(pr._id)"></i>
          </div>

          <!-- Approve/Reject -->
          <div *ngIf="pr.status !== 'Approved' && pr.status !== 'Rejected'">
            <button class="btn btn-sm btn-outline-success me-2" (click)="approve(pr._id)">
                 Approve
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="reject(pr._id)">
                 Reject
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div class="pagination d-flex justify-content-center align-items-center my-3" *ngIf="requisitions.length > 0">
    <button
      class="pagination-btn btn btn-primary mx-2"
      (click)="previousPage()"
      [disabled]="currentPage === 1">
      Previous
    </button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button
      class="pagination-btn btn btn-primary mx-2"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages">
      Next
    </button>
  </div>
</div>
