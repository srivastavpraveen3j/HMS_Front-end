<div class="form-meta">
  <div class="header">
    <h2>Vendor Quotation</h2>
    <span class="icons position-relative"></span>
  </div>

  <!-- Quotation Form (shown when not submitted) -->
  <div *ngIf="!quotationSubmitted" class="quote-form">
    <div class="quotation-info mb-4">
      <div class="row">
        <div class="col-md-6">
          <p><strong>RFQ Number:</strong> {{ rfq?.rfqNumber }}</p>
          <p><strong>Vendor:</strong> {{ rfq?.vendorName }}</p>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-8">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="gstIncluded"
                  [(ngModel)]="gstIncluded"
                  (change)="onGSTToggle()"
                >
                <label class="form-check-label" for="gstIncluded">
                  <strong>Include GST</strong>
                </label>
              </div>
            </div>
            <div class="col-md-4" *ngIf="gstIncluded">
              <div class="input-group input-group-sm">
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="gstPercentage"
                  (ngModelChange)="onGSTPercentageChange()"
                  min="0"
                  max="50"
                  step="0.1"
                  placeholder="18"
                  [disabled]="isSubmitting"
                >
                <span class="input-group-text">%</span>
              </div>
              <small class="text-muted">GST Rate</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-primary">
          <tr>
            <th>Sr. No.</th>
            <th>Medicine Name</th>
            <th>Brand</th>
            <th>Strength</th>
            <th>Quantity</th>
            <th>Unit Price (₹)</th>
            <th>Discount (%)</th>
            <th>Net Price (₹)</th>
            <th>Total Price (₹)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of rfq?.items; let i = index">
            <td>{{ i + 1 }}</td>
            <td>
              <div>
                <strong>{{ item.itemName }}</strong>
                <small class="d-block text-muted" *ngIf="item.description">{{ item.description }}</small>
              </div>
            </td>
            <td>
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="item.brand"
                [disabled]="isSubmitting"
                placeholder="Brand"
              />
            </td>
            <td>
              <input
                type="text"
                class="form-control form-control-sm"
                [(ngModel)]="item.strength"
                [disabled]="isSubmitting"
                placeholder="Strength"
              />
            </td>
            <td class="text-center">
              <span class="badge bg-info">{{ item.quantityRequired }}</span>
            </td>
            <td>
              <input
                type="number"
                class="form-control form-control-sm"
                [(ngModel)]="item.unitPrice"
                (ngModelChange)="onUnitPriceChange(item)"
                [disabled]="isSubmitting"
                min="0"
                step="0.01"
                placeholder="Enter price"
              />
            </td>
            <td>
              <div class="input-group input-group-sm">
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="item.discount"
                  (ngModelChange)="onDiscountChange(item)"
                  [disabled]="isSubmitting"
                  min="0"
                  max="100"
                  step="0.1"
                  placeholder="0"
                />
                <span class="input-group-text">%</span>
              </div>
            </td>
            <td class="text-end">
              <span class="text-success">
                <strong>  {{ item.netPrice | indianCurrency }}</strong>
              </span>
            </td>
            <td class="text-end">
              <strong>{{ item.totalPrice | indianCurrency }}</strong>
            </td>
          </tr>
        </tbody>
        <tfoot class="table-light">
          <tr>
            <td colspan="8" class="text-end"><strong>Subtotal:</strong></td>
            <td class="text-end">
              <strong class="text-primary">{{ getSubtotal() | indianCurrency }}</strong>
            </td>
          </tr>
          <tr *ngIf="getTotalDiscountAmount() > 0">
            <td colspan="8" class="text-end"><strong>Total Discount:</strong></td>
            <td class="text-end">
              <strong class="text-warning">-{{ getTotalDiscountAmount() | indianCurrency }}</strong>
            </td>
          </tr>
          <tr *ngIf="gstIncluded">
            <td colspan="8" class="text-end">
              <strong>GST ({{ gstPercentage }}%):</strong>
            </td>
            <td class="text-end">
              <strong class="text-info">{{ getGSTAmount() | indianCurrency }}</strong>
            </td>
          </tr>
          <tr class="table-dark">
            <td colspan="8" class="text-end"><strong>Grand Total:</strong></td>
            <td class="text-end">
              <strong class="text-success fs-5">{{ getGrandTotal() | indianCurrency }}</strong>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="text-center mt-4">
      <button
        (click)="submitQuote()"
        class="btn btn-primary btn-lg"
        [disabled]="isSubmitting || !isFormValid()"
      >
        <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"></span>
        {{ isSubmitting ? 'Submitting...' : 'Submit Quotation' }}
      </button>
    </div>

    <!-- Form validation message -->
    <div *ngIf="!isFormValid()" class="alert alert-warning mt-3">
      <i class="fa-solid fa-exclamation-triangle me-2"></i>
      Please enter unit prices for all items and fill in required fields before submitting.
    </div>
  </div>

  <!-- Thank You Page (shown after submission) -->
  <div *ngIf="quotationSubmitted" class="thank-you-container">
    <div class="thank-you-card fade-in">
      <div class="thank-you-content">
        <h2 class="thank-you-title">Thank You</h2>

        <div class="success-message">
          <i class="fa-solid fa-circle-check success-icon"></i>
          <h4>Thank You for Considering Our Proposal</h4>
        </div>

        <p class="message-text">
          We appreciate the opportunity to submit this quotation. Our team is committed to
          delivering quality solutions that match your expectations.
        </p>

        <!-- Quotation Summary -->
        <div class="quotation-summary">
          <div class="summary-item">
            <strong>RFQ Number:</strong> {{ rfq?.rfqNumber }}
          </div>
          <div class="summary-item">
            <strong>Vendor:</strong> {{ rfq?.vendorName }}
          </div>
          <div class="summary-item">
            <strong>Items Quoted:</strong> {{ rfq?.items?.length || 0 }}
          </div>
          <div class="summary-item">
            <strong>Subtotal:</strong> ₹{{ getSubtotal() | indianCurrency }}
          </div>
          <div class="summary-item" *ngIf="getTotalDiscountAmount() > 0">
            <strong>Total Discount:</strong> ₹{{ getTotalDiscountAmount() | indianCurrency }}
          </div>
          <div class="summary-item" *ngIf="gstIncluded">
            <strong>GST ({{ gstPercentage }}%):</strong> ₹{{ getGSTAmount() | indianCurrency }}
          </div>
          <div class="summary-item">
            <strong>Grand Total:</strong> ₹{{ getGrandTotal() | indianCurrency }}
          </div>
          <div class="summary-item">
            <strong>Submitted On:</strong> {{ submissionDate | date: 'dd/MM/yyyy HH:mm' }}
          </div>
        </div>

        <div class="footer-message">
          <p><strong>We look forward to working with you</strong></p>
        </div>

        <div class="action-buttons mt-4">
          <button class="btn btn-outline-primary" onclick="window.print()">
            <i class="fa-solid fa-print me-2"></i>
            Print Confirmation
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
