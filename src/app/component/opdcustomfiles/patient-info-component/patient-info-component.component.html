<div id="opd-sheet" class="opd-sheet" *ngIf="patientData">
  <!-- Header -->
  <div class="header">
    <!-- <img src="P P Maniya_page-0001.jpg" alt="Logo" class="logo" /> -->
    <img src="P P Maniya_page-0001.jpg" alt="Logo" class="logo" />
  </div>

  <!-- Title -->
  <h3 class="center-title">Invoice</h3>

  <!-- Info Section -->
  <div class="info-grid">
    <div class="left-info">
      <!-- <p><strong>UHID NO :</strong> {{ patientData?.patientUhid?.uhid }} &nbsp;&nbsp; </p> -->
      <p>
        <strong>NAME :</strong> {{ patientData?.patientUhid?.patient_name }}
      </p>
      <p><strong>ADDRESS :</strong> {{ patientData?.patientUhid?.area }}</p>
      <p>
        <strong>AGE / SEX :</strong> {{ patientData?.patientUhid?.age }} /
        {{ patientData?.patientUhid?.gender === "male" ? "Male" : "Female" }}
      </p>
      <p>
        <strong>Treating Dr. :</strong>
        {{ patientData.OutpatientcaseId?.consulting_Doctor?.name }}
      </p>
      <p *ngIf="patientData.convertFromAppointment">
        <strong>TOKEN No.:</strong>
        {{ patientData.appointmentId?.token_number }}
      </p>

      <!-- <p><strong>CONS. DR. :</strong> {{ patientData?.consulting_Doctor?.name }}</p> -->
    </div>
    <div class="right-info">
      <p>
        <strong>UHID NO :</strong>
        {{ patientData?.patientUhid?.uhid }} &nbsp;&nbsp;
      </p>
      <p>
        <strong>INVOICE No. :</strong>
        {{ patientData?.billnumber }} &nbsp;&nbsp;
      </p>
      <p>
        <strong>DATE :</strong> {{ patientData?.createdAt | date }}
        <!-- <p><strong>AGE / SEX :</strong> {{ patientData?.patientUhid?.age }} / {{ patientData?.patientUhid?.gender === 'male' ? 'Male' : 'Female' }}</p> -->
        <!-- <p><strong>PHONE NO. :</strong> {{ patientData?.patientUhid?.mobile_no }}</p> -->
      </p>

      <p>
        <strong>Ref Dr. :</strong>
        {{ patientData.OutpatientcaseId?.referringDoctorId?.name }}
      </p>

      <p>
        <strong>Mobile Number :</strong>{{ patientData.patientUhid.mobile_no }}
      </p>
    </div>
  </div>

  <hr class="divider" />

  <!-- ... rest unchanged, but everywhere replace patientData[0] with patientData ... -->

  <!-- Services Table -->

  <span>Bill Number: {{ patientData?.billnumber || "N/A" }}</span>

  <table class="table table-bordered mt-3">
    <thead>
      <tr>
        <th>Sr. No</th>
        <th>Details</th>
        <th class="text-end">Charge (₹)</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngIf="patientData?.services?.length; else noServices">
        <tr *ngFor="let service of patientData.services; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ service?.name || "Unnamed Service" }}</td>
          <td class="text-end">{{ service?.charge | number : "1.2-2" }}</td>
        </tr>
      </ng-container>

      <!-- Optional: fallback if no services -->
      <ng-template #noServices>
        <tr>
          <td colspan="3" class="text-center text-muted">No services found.</td>
        </tr>
      </ng-template>
    </tbody>
  </table>

  <!-- Billing Summary -->
  <div class="row mt-4">
    <div class="col-md-6">
      <!-- <p><strong>Payment Method:</strong> {{ patientData?.paymentmethod }}</p> -->
      <!-- <p><strong>Remarks:</strong> {{ patientData?.remarks }}</p> -->
    </div>
    <div class="col-md-6 text-end">
      <p>
        <strong>Total :</strong> ₹{{
          patientData?.totalamount | number : "1.2-2"
        }}
      </p>
      <p>
        <strong>Discount :</strong> ₹{{
          patientData?.DiscountMeta?.discountStatus === "approved"
            ? patientData?.DiscountMeta?.discount
            : (0 | number : "1.2-2")
        }}
      </p>
      <p>
        <strong>Received :</strong> ₹{{
          patientData?.amountreceived | number : "1.2-2"
        }}
      </p>
      <!-- <p *ngIf="patientData?.remainder > 0">
      <strong>Remainder:</strong> ₹{{ patientData?.remainder | number:'1.2-2' }}
    </p> -->
    </div>
  </div>

  <div class="footer mt-4">
    <div class="col-md-6" style="float: left">
      <p><strong>Entry By:</strong> {{ patientData?.entryByUser }}</p>
      <p>
        <strong>Date & Time:</strong>
        {{ patientData?.createdAt | date : "dd-MMM-yyyy hh:mm a" }}
      </p>
    </div>
    <div class="col-md-6 text-end" style="float: right">
      <p>
        <strong>Due:</strong>
        ₹
        {{
          patientData?.totalamount -
            (patientData?.DiscountMeta?.discountStatus === "approved"
              ? patientData?.DiscountMeta?.discount || 0
              : 0) -
            (patientData?.amountreceived || 0) | number : "1.2-2"
        }}
      </p>
    </div>
  </div>

  <!-- Print button stays the same -->
  <footer class="m-3 d-flex justify-content-between">
    <button class="btn btn-dark" (click)="printOPDSheet()">
      Print <i class="fa-solid fa-print action-btn"></i>
    </button>
  </footer>
</div>
