<div class="" id="po-sheet no-break" >
  <!-- Company Header using letterheader component -->
  <app-letterheader class="po-header-section"></app-letterheader>

  <!-- Document Title -->
  <div class="document-title-bar">
    <h2>PURCHASE ORDER</h2>
  </div>

  <!-- PO Information Section -->
  <div class="po-info-section mb-4">
    <div class="row">
      <div class="col-md-6">
        <h4>Purchase Order Details</h4>
        <p><strong>PO Number:</strong> {{ purchaseOrder?.poNumber }}</p>
        <p><strong>Order Date:</strong> {{ purchaseOrder?.createdAt | date: 'dd/MM/yyyy' }}</p>
        <p><strong>Delivery Date:</strong> {{ purchaseOrder?.deliveryDate | date: 'dd/MM/yyyy' }}</p>
        <!-- <p><strong>Status:</strong> <span class="badge bg-primary">{{ (purchaseOrder?.status | titlecase) || 'Pending' }}</span></p> -->
      </div>
      <div class="col-md-6">
        <h4>Reference Information</h4>
        <p><strong>RFQ Number:</strong> {{ purchaseOrder?.rfq?.number || 'N/A' }}</p>
        <p><strong>PO Type:</strong> <span >{{ (purchaseOrder?.poType | titlecase) || 'Regular' }}</span></p>
        <p><strong>Department:</strong> {{ purchaseOrder?.department || 'Central Store Pharmacy' }}</p>
        <p><strong>Warranty:</strong> {{ purchaseOrder?.warrantyPeriod || 'As per manufacturer' }}</p>
      </div>
    </div>
  </div>

  <!-- Parties Information -->
  <div class="po-parties mb-4">
    <div class="row">
      <div class="col-md-6">
        <div class="party-box buyer-section">
          <h4>Buyer Details</h4>
          <p><strong>{{ purchaseOrder?.createdBy?.designation || 'PP Maniya Hospital' }}</strong></p>
          <p>Staff Name: {{ purchaseOrder?.createdBy?.name }}</p>
          <p>Email: {{ purchaseOrder?.createdBy?.email }}</p>
          <p>Department: {{ purchaseOrder?.department || 'Central Store Pharmacy' }}</p>
        </div>
      </div>
      <div class="col-md-6">
        <div class="party-box vendor-section">
          <h4>Vendor Details</h4>
          <p><strong>{{ purchaseOrder?.vendor?.name }}</strong></p>
          <p>Phone: {{ purchaseOrder?.vendor?.phone }}</p>
          <p>Email: {{ purchaseOrder?.vendor?.email }}</p>
          <!-- <p>Vendor ID: {{ purchaseOrder?.vendor?.id?._id?.slice(-8) || 'N/A' }}</p> -->
        </div>
      </div>
    </div>
  </div>

  <!-- Items Table -->
  <div class="items-section">
  <h4>Order Items</h4>
  <table class="table table-bordered po-table">
    <thead class="table-dark">
      <tr>
        <th style="width: 8%">#</th>
        <th style="width: 42%">Item Description</th>
        <th style="width: 10%">Unit</th>
        <th style="width: 12%">Quantity</th>
        <th style="width: 14%">Unit Price (₹)</th>
        <th style="width: 14%">Total Amount (₹)</th>
        <!-- ✅ GST Column Removed -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of purchaseOrder?.items; let i = index">
        <td class="text-center">{{ i + 1 }}</td>
        <td>
          <strong>{{ item.name }}</strong>
          <br><small class="text-muted">Category: {{ item.category || 'General' }}</small>
          <!-- <br><small class="text-muted">Item ID: {{ item.itemId?.slice(-8) || 'N/A' }}</small> -->
        </td>
        <td class="text-center">{{ item.unit || 'Nos' }}</td>
        <td class="text-center">{{ item.quantity | number: '1.0-0' }}</td>
        <td class="text-end">{{ item.unitPrice | currency: '₹':'symbol':'1.2-2' }}</td>
        <td class="text-end"><strong>{{ item.totalPrice | currency: '₹':'symbol':'1.2-2' }}</strong></td>
        <!-- ✅ GST Cell Removed -->
      </tr>
    </tbody>
    <tfoot class="table-light">
      <tr>
        <td colspan="5" class="text-end"><strong>Grand Total:</strong></td>
        <td class="text-end"><strong>{{ purchaseOrder?.total | currency: '₹':'symbol':'1.2-2' }}</strong></td>
        <!-- ✅ Adjusted colspan from 6 to 5 -->
      </tr>
    </tfoot>
  </table>
</div>


  <!-- Enhanced Terms & Conditions Section -->
  <div class="po-summary">
    <div class="row">
      <div class="col-md-8">
        <div class="terms-section">
          <h5>Terms & Conditions:</h5>

          <!-- ✅ Dynamic Terms from Backend -->
          <ul class="terms-list" *ngIf="purchaseOrder?.termsAndConditions?.length > 0; else defaultTerms">
            <li *ngFor="let term of purchaseOrder.termsAndConditions">{{ term }}</li>
          </ul>

          <!-- ✅ Fallback Default Terms -->
          <ng-template #defaultTerms>
            <ul class="terms-list">
              <li>Payment terms: {{ purchaseOrder?.paymentTerms || '30 days from invoice date' }}</li>
              <li>Delivery terms: {{ purchaseOrder?.deliveryTerms || 'FOB destination' }}</li>
              <li *ngIf="purchaseOrder?.qualityStandards">Quality standards: All items must meet specified quality requirements</li>
              <li *ngIf="purchaseOrder?.lateDeliveryPenalty">Late delivery: Penalties may apply for delayed deliveries</li>
              <li *ngIf="purchaseOrder?.returnPolicy">Returns: Damaged or non-conforming items will be returned at supplier cost</li>
              <li *ngIf="purchaseOrder?.inspectionRights">Inspection: Buyer reserves the right to inspect goods before acceptance</li>
            </ul>
          </ng-template>

          <!-- ✅ Special Instructions -->
          <div class="special-instructions mt-3">
            <h6>Special Instructions:</h6>
            <div class="border p-3 bg-light" style="min-height: 60px;">
              <p class="mb-0">{{ purchaseOrder?.specialInstructions || 'Please ensure all items are packed securely and delivered to the specified address during business hours.' }}</p>
            </div>
          </div>

          <!-- ✅ Custom Terms (if any) -->
          <div class="custom-terms mt-3" *ngIf="purchaseOrder?.customTerms">
            <h6>Additional Terms:</h6>
            <div class="border p-3 bg-light">
              <p class="mb-0">{{ purchaseOrder.customTerms }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="financial-summary">

            <div class="key-dates mt-3">
          <!-- <h6>Important Dates:</h6> -->
          <table class="table table-sm">
            <tr>
              <td><strong>Order Date:</strong></td>
              <td>{{ purchaseOrder?.createdAt | date: 'dd/MM/yyyy' }}</td>
            </tr>
            <tr>
              <td><strong>Delivery Date:</strong></td>
              <td class="text-danger"><strong>{{ purchaseOrder?.deliveryDate | date: 'dd/MM/yyyy' }}</strong></td>
            </tr>
            <tr *ngIf="purchaseOrder?.expectedResolutionDate">
              <td><strong>Resolution Date:</strong></td>
              <td>{{ purchaseOrder.expectedResolutionDate | date: 'dd/MM/yyyy' }}</td>
            </tr>
          </table>
        </div>
          <table class="table table-sm summary-table">
            <!-- <tr>
              <td><strong>Subtotal:</strong></td>
              <td class="text-end">{{ subtotal | currency: '₹':'symbol':'1.2-2' }}</td>
            </tr> -->
            <!-- <tr>
              <td><strong>Total GST:</strong></td>
              <td class="text-end">{{ totalGST | currency: '₹':'symbol':'1.2-2' }}</td>
            </tr> -->
            <tr *ngIf="purchaseOrder?.shippingCost">
              <td><strong>Shipping:</strong></td>
              <td class="text-end">{{ purchaseOrder.shippingCost | currency: '₹':'symbol':'1.2-2' }}</td>
            </tr>
            <tr *ngIf="purchaseOrder?.otherCharges">
              <td><strong>Other Charges:</strong></td>
              <td class="text-end">{{ purchaseOrder.otherCharges | currency: '₹':'symbol':'1.2-2' }}</td>
            </tr>
            <tr class="table-success">
              <td><strong>Grand Total:</strong></td>
              <td class="text-end"><strong>{{ purchaseOrder?.total | currency: '₹':'symbol':'1.2-2' }}</strong></td>
            </tr>


          </table>
        </div>

        <!-- ✅ Key Dates -->

      </div>
    </div>
  </div>

  <!-- Approval & Signatures Section -->
  <div class="signatures-section mt-5">
    <div class="row">
      <div class="col-md-3 text-center">
        <div class="signature-box">
          <div class="signature-line"></div>
          <p><strong>Requested By</strong><br>{{ purchaseOrder?.createdBy?.name }}</p>
          <small>Date: {{ purchaseOrder?.createdAt | date: 'dd/MM/yyyy' }}</small>
        </div>
      </div>
      <div class="col-md-3 text-center">
        <div class="signature-box">
          <div class="signature-line"></div>
          <p><strong>Approved By</strong><br>Department Head</p>
          <small>Date: _____________</small>
        </div>
      </div>
      <div class="col-md-3 text-center">
        <div class="signature-box">
          <div class="signature-line"></div>
          <p><strong>Authorized By</strong><br>Purchase Manager</p>
          <small>Date: _____________</small>
        </div>
      </div>
      <div class="col-md-3 text-center">
        <div class="signature-box">
          <div class="signature-line"></div>
          <p><strong>Vendor Acknowledgment</strong><br>{{ purchaseOrder?.vendor?.name }}</p>
          <small>Date: _____________</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Information -->
  <div class="po-footer mt-4">
    <div class="row">
      <div class="col-md-12 text-center">
        <small class="text-muted">
          This purchase order is electronically generated and is valid without signature.
          Please quote PO number <strong>{{ purchaseOrder?.poNumber }}</strong> in all correspondence.
          <br>Generated on {{ purchaseOrder?.createdAt | date: 'dd/MM/yyyy HH:mm' }}
        </small>
      </div>
    </div>
  </div>
</div>

<!-- Print Button -->
<footer class="text-end mt-3 no-print">
  <button class="btn  btn-sm" (click)="printPOSheet()" [disabled]="!purchaseOrder">
    <i class="fa-solid fa-download me-2"></i>Download PO
  </button>
  <button class="btn  btn-sm"  [disabled]="!purchaseOrder" (click)="print()">
    <i class="fa-solid fa-print me-2" ></i>Print PO
  </button>
  <button class="btn  btn-sm ms-2" (click)="goBack()">
    <i class="fa-solid fa-arrow-left me-2"></i>Back to List
  </button>
</footer>
