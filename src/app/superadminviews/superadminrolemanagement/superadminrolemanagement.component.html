<div class="header">
    <h3>Role Management</h3>
    <i class="fa-solid fa-signal" [routerLink]="['/superadmin/superadminrolelist']" routerLinkActive="router-link-active"></i>
</div>

<div class="card p-4 mt-2">
    <!-- Role Form -->
    <form [formGroup]="roleForm" (ngSubmit)="saveRole()">
        <div class="form-row">
            <div class="form-group">
                <label class="form-label"><strong>Role Name:</strong></label>
                <input type="text" class="form-control" formControlName="name" required />
            </div>
    
            <div class="form-group">
                <label class="form-label"><strong>Description:</strong></label>
                <input type="text" class="form-control" formControlName="description" required />
            </div>
        </div>
    
        <div class="form-group">
            <label class="form-label"> <strong>Permissions:</strong></label>
            <div class="custom-multiselect">
                <div class="selected-items">
                    <span *ngFor="let perm of selectedPermissions" class="selected-tag">
                        {{ perm.name }}
                        <span class="remove-tag" (click)="removePermission(perm)">Ã—</span>
                    </span>
                    <input type="hidden" formControlName="PlatformPermission" />
                </div>
                <!-- Search input -->
                <input type="text" class="search-input" placeholder="Search permissions..." [value]="permissionSearch"
                    (input)="onPermissionSearch($event)" (focus)="dropdownOpen = true" />
                <!-- Dropdown list (only after 2 chars) -->
                <ul class="dropdown-list" *ngIf="dropdownOpen && filteredPermissions().length > 0">
                    <li *ngFor="let perm of filteredPermissions()" (click)="selectPermission(perm)">
                        {{ perm.name }} ({{ perm.action }})
                    </li>
                </ul>
            </div>
        </div>

    
        <div class="text-center mt-3">
            <button class="btn btn-dark mx-2" type="submit">
                {{ isEditing ? 'Update Role' : 'Create Role' }}
            </button>
            <button class="btn btn-secondary" type="button" (click)="resetForm()" *ngIf="isEditing">
                Cancel
            </button>
        </div>
    </form>
</div>