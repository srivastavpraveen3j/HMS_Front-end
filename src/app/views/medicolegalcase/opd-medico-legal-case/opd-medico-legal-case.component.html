<!-- Filters Section -->
<div class="filters text-center m-3 d-flex justify-content-between align-items-center">
    <!-- Doctor Select -->
    <div class="form-group w-50 mx-3 position-relative">
        <label>Search Doctor</label>
        <input type="text" class="form-control" placeholder="Type doctor name..." [(ngModel)]="doctorSearchText"
            (input)="onDoctorSearchChange(doctorSearchText)" autocomplete="off" />

        <ul *ngIf="filteredDoctors.length > 0 && doctorSearchText.trim().length > 0"
            class="list-group position-absolute w-100 zindex-dropdown" style="max-height: 200px; overflow-y: auto">
            <li class="list-group-item list-group-item-action" *ngFor="let doctor of filteredDoctors"
                (click)="onDoctorSelected(doctor.name)">
                {{ doctor.name }}
            </li>
        </ul>
    </div>

    <!-- Filter by Today or Date Range -->
    <div class="filters d-flex align-items-center">
        <label class="m-3">
            <input type="radio" name="filter" value="today" [(ngModel)]="activeFilter" (change)="applyFilters()"
                checked />
            TODAY'S
        </label>

        <label class="m-3">
            <input type="radio" name="filter" value="dateRange" [(ngModel)]="activeFilter" (change)="applyFilters()" />
            Date Range
        </label>

        <!-- Date Inputs Visible Only for Date Range -->
        <input *ngIf="activeFilter === 'dateRange'" type="date" [(ngModel)]="startDate" (change)="applyFilters()"
            class="form-control mx-2" />
        <input *ngIf="activeFilter === 'dateRange'" type="date" [(ngModel)]="endDate" (change)="applyFilters()"
            class="form-control mx-2" />
    </div>
</div>


<div class="loader-wrapper" *ngIf="filteredCases.length === 0">
    <div class="loader">
        <img src="Untitled design (6).jpg" alt="Loading..." class="loading-img" />
    </div>
</div>

<div class="" *ngIf="filteredCases.length > 0">
    <table class="table table-bordered table-hover align-middle diagnosis-table" *ngIf="userPermissions.read">
        <thead class="table-dark text-center">
            <tr>
                <th>#</th>
                <th>Medical Number</th>
                <th>UHID</th>
                <th>Patient Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Consulting Doctor</th>
                <th>Date of Treatment</th>
                <th>Time of Treatment</th>
                <!-- <th>Email</th> -->
                <!-- <th>PAN Card</th> -->
                <th>Mobile No</th>
                <th>Area</th>
                <th>Police Informer</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let patient of filteredCases; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ patient.medicoLegalCaseNumber }}</td>
                <td>{{ patient.uniqueHealthIdentificationId?.uhid }}</td>
                <td style="cursor: pointer; color: blue">
                    {{ patient.uniqueHealthIdentificationId?.patient_name }}
                </td>
                <td>{{ patient.uniqueHealthIdentificationId?.age }}</td>
                <td>{{ patient.uniqueHealthIdentificationId?.gender }}</td>
                <td>{{ patient.treatingDoctor?.name }}</td>
                <td>{{ patient.createdAt | date : "yyyy-MM-dd" }}</td>
                <td>{{ patient.uniqueHealthIdentificationId?.dot }}</td>
                <!-- <td>{{ patient.emailAddress }}</td> -->
                <!-- <td>{{ patient.panCardNumber }}</td> -->
                <td>{{ patient.uniqueHealthIdentificationId?.mobile_no }}</td>
                <td>{{ patient.uniqueHealthIdentificationId?.area }}</td>
                <td>{{ patient.policeInformerFullName }}</td>
                <td>
                    <i class="fa-solid fa-pencil action-btn" *ngIf="userPermissions.update" (click)="editMedicoCase(patient._id)"></i>
                    <i class="fa-solid fa-trash action-btn" *ngIf="userPermissions.delete" (click)="deleteMedicoCase(patient._id)"></i>
                 
                </td>
                <!-- <td> -->
                    <!-- <i class="fa-solid fa-eye action-btn" (click)="viewPatient(patient._id)"></i> -->
                    <!-- <i class="fa-solid fa-pencil action-btn" *ngIf="userPermissions.update"
                        (click)="editOpdcase(patient._id)"></i>
                    <i class="fa-solid fa-trash action-btn" *ngIf="userPermissions.delete"
                        (click)="deleteOpdcase(patient._id)"></i>
                    <i class="fa-solid fa-ellipsis-vertical" role="button" [attr.id]="'dropdownMenu' + i"
                        data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"
                        [attr.aria-controls]="'dropdownList' + i"></i>
                    <ul class="dropdown-menu dropdown-menu-end" [attr.aria-labelledby]="'dropdownMenu' + i"
                        [attr.id]="'dropdownList' + i" role="menu">
                        <li role="menuitem">
                            <button class="dropdown-item" (click)="openSummary(patient.uniqueHealthIdentificationId?._id)">
                                Patient Summary
                            </button>
                        </li>
                        <li role="menuitem">
                            <button class="dropdown-item" (click)="viewPatient(patient._id)">
                                View
                            </button>
                        </li>
                        <li role="menuitem">
                            <button class="dropdown-item" (click)="openBill(patient._id)">
                                Bill
                            </button>
                        </li> -->
                        <!-- <li role="menuitem"><button class="dropdown-item" (click)="openDeposit(patient._id)">Deposit</button></li> -->
                    <!-- </ul> -->
                <!-- </td> -->
            </tr>
        </tbody>
    </table>
</div>