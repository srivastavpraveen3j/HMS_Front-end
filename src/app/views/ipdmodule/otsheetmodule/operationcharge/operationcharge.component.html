<div class="form-meta">
  <div class="header">
    <h2>OPERATION Charge</h2>
  </div>
  <div>
    <div class="form-check form-switch mb-2">
      <input
        class="form-check-input"
        type="checkbox"
        [(ngModel)]="packageBreakdownEnabled"
        id="packageBreakdownEnabled"
      />
      <label class="form-check-label" for="packageBreakdownEnabled">
        Enable Package Charge Breakdown
      </label>
    </div>
    <form
      [formGroup]="otchargeform"
      (ngSubmit)="OnSubmit()"
      *ngIf="userPermissions.create"
    >
      <!-- ... Patient Details as per your snippet ... -->

      <div class="row">
        <div class="col-md-6 position-relative">
          <label class="form-label">Operation Name*</label>
          <input
            formControlName="name"
            class="form-control"
            autocomplete="off"
            placeholder="Type or select surgery..."
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Operation Type*</label>
          <select class="form-control" formControlName="ottype">
            <option value="otcharge">Operation Charge</option>
            <option value="deliverycharge">Delivery Charge</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <label class="form-label">Total Price *</label>
          <input
            type="number"
            formControlName="totalPrice"
            class="form-control"
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Note</label>
          <textarea
            class="form-control"
            formControlName="note"
            rows="1"
          ></textarea>
        </div>
      </div>

      <!-- FLAT PACKAGE CHARGE ENTRY TABLE -->
      <!-- FLAT PACKAGE CHARGE ENTRY TABLE -->
      <div class="col-md-12 mt-3" *ngIf="packageBreakdownEnabled">
        <form [formGroup]="otchargeform" (ngSubmit)="OnSubmit()">
          <table class="table table-bordered">
            <thead class="table-dark">
              <tr>
                <th>Charge Type</th>
                <th>Amount (â‚¹)</th>
                <th>Name</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let type of chargeTypeOptions; let i = index" [formGroup]="asFormGroup(entries.at(i))">
                <td>{{ type }}</td>
                <td>
                  <input
                    type="number"
                    formControlName="amount"
                    class="form-control"
                    min=""
                  />
                </td>
                <td style="position: relative">
                  <input
                    type="text"
                    formControlName="staffName"
                    class="form-control"
                    placeholder="Search/select staff"
                    autocomplete="off"
                    (input)="
                      onStaffSearch(
                        getInputValue($event),
                        asFormGroup(entries.at(i)),
                        i
                      )
                    "
                    (focus)="onStaffFocus(i)"
                    (blur)="onStaffBlur()"
                  />
                  <div
                    *ngIf="showStaffDropdownIndex === i && filteredStaff.length"
                    class="suggestion-container"
                  >
                    <ul
                      class="suggestions"
                    >
                      <li
                        *ngFor="let user of filteredStaff"
                        (mousedown)="
                          onStaffSelect(user, asFormGroup(entries.at(i)), i)
                        "
                        style="padding: 6px; cursor: pointer"
                      >
                        {{ user.name }} | {{ user.role?.name }}
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- <div class="text-end">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isSubmitting"
            >
              Save Charges
            </button>
          </div> -->
        </form>
      </div>

      <button type="submit" class="btn btn-dark mt-4" [disabled]="isSubmitting">
        Save
      </button>
    </form>
  </div>
</div>
