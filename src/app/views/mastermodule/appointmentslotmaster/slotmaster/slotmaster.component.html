<div class="form-meta">
    <div class="header">
        <h2>ADD APPOINTMENT SLOT</h2>
        <span class="icons position-relative">
            <i class="fa-solid fa-signal" [routerLink]="['/master/slotmasterlist']"
                routerLinkActive="router-link-active"></i>
        </span>
    </div>

    <div *ngIf="userPermissions.create">
        <form [formGroup]="slotForm" (ngSubmit)="onSubmit()">
            <div class="form-container">
                <!-- Left Side -->
                <div class="form-half">
                    <div class="form-group">
                        <label>Doctor <span class="required">*</span></label>
                        <div class="custom-select-wrapper">
                            <select class="form-control" formControlName="doctor">
                                <option value="">-- Select Doctor --</option>
                                <option *ngFor="let doc of doctors" [value]="doc._id">
                                    {{ doc.name }}
                                </option>
                            </select>
                        </div>
                        <div *ngIf="slotForm.get('doctor')?.touched && slotForm.get('doctor')?.invalid"
                            class="text-danger">
                            Doctor is Required
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Appointment Type </label>
                        <div class="custom-select-wrapper">
                            <select class="form-control" formControlName="appointmentType">
                                <option value="">-- Select Type --</option>
                                <option value="opd">OPD</option>
                                <!-- <option *ngFor="let at of appointmentTypes" [value]="at._id">
                                    {{ at.name }}
                                </option> -->
                            </select>
                        </div>
                        <!-- <div *ngIf="slotForm.get('appointmentType')?.touched && slotForm.get('appointmentType')?.invalid"
                            class="text-danger">
                            Appointment Type is Required
                        </div> -->
                    </div>

                    <div class="form-group">
                        <label>Working Days <span class="required">*</span></label>
                        <div class="days-container">
                            <label *ngFor="let day of weekdays" class="day-option">
                                <input type="checkbox" [value]="day" (change)="toggleDay(day, $event)"
                                    [checked]="isDaySelected(day)" />
                                {{ day }}
                            </label>
                        </div>
                        <div *ngIf="selectedDays.length === 0" class="text-danger">
                            At least one day must be selected
                        </div>
                    </div>
                </div>

                <!-- Right Side -->
                <!-- <div class="form-half">
                    <div class="form-group">
                        <label>Start Time <span class="required">*</span></label>
                        <input type="time" formControlName="startTime" class="form-control" />
                        <div *ngIf="slotForm.get('startTime')?.touched && slotForm.get('startTime')?.invalid"
                            class="text-danger">
                            Start Time is Required
                        </div>
                    </div>

                    <div class="form-group">
                        <label>End Time <span class="required">*</span></label>
                        <input type="time" formControlName="endTime" class="form-control" />
                        <div *ngIf="slotForm.get('endTime')?.touched && slotForm.get('endTime')?.invalid"
                            class="text-danger">
                            End Time is Required
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Duration per Slot (mins) <span class="required">*</span></label>
                        <select class="form-control" formControlName="slotDuration">
                            <option value="">-- Select Duration --</option>
                            <option [value]="15">15</option>
                            <option [value]="20">20</option>
                            <option [value]="30">30</option>
                            <option [value]="45">45</option>
                            <option [value]="60">60</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Max Appointments <span class="required">*</span></label>
                        <input type="number" formControlName="maxAppointments" class="form-control"
                            placeholder="e.g., 4" />
                        <div *ngIf="slotForm.get('maxAppointments')?.touched && slotForm.get('maxAppointments')?.invalid"
                            class="text-danger">
                            Max Appointments is Required
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            Active
                            <input type="checkbox" formControlName="isActive" />
                        </label>
                    </div>
                </div> -->

                <div class="form-half">
                    <div formArrayName="timeSlots">
                        <div *ngFor="let slot of timeSlots.controls; let i=index" [formGroupName]="i" class="time-slot-group">
                            <div class="form-group">
                                <label>Start Time <span class="required">*</span></label>
                                <input type="time" formControlName="startTime" class="form-control" />
                                <div *ngIf="slotForm.get('startTime')?.touched && slotForm.get('startTime')?.invalid" class="text-danger">
                                    Start Time is Required
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label>End Time <span class="required">*</span></label>
                                <input type="time" formControlName="endTime" class="form-control" />
                                <div *ngIf="slotForm.get('endTime')?.touched && slotForm.get('endTime')?.invalid" class="text-danger">
                                    End Time is Required
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label>Duration per Slot (mins) <span class="required">*</span></label>
                                <div class="custom-select-wrapper">
                                    <select class="form-control" formControlName="slotDuration">
                                        <option value="">-- Select Duration --</option>
                                        <option [value]="15">15</option>
                                        <option [value]="20">20</option>
                                        <option [value]="30">30</option>
                                        <option [value]="45">45</option>
                                        <option [value]="60">60</option>
                                    </select>
                                </div>
                            </div>
                    
                            <div class="form-group">
                                <label>Total Appointments <span class="required">*</span></label>
                                <input type="number" formControlName="maxAppointments" class="form-control" placeholder="e.g., 4" readonly />
                                <div *ngIf="slotForm.get('maxAppointments')?.touched && slotForm.get('maxAppointments')?.invalid"
                                    class="text-danger">
                                    Total Appointments is Required
                                </div>
                            </div>
    
                            <div class="form-group mb-1">
                                <label>
                                    Active
                                    <input type="checkbox" formControlName="isActive" />
                                </label>
                            </div>
                    
                            <button type="button" class="btn btn-danger" (click)="removeTimeSlot(i)" *ngIf="timeSlots.length > 1">
                                Remove
                            </button>
                        </div>
                    
                        <button type="button" class="btn btn-secondary mt-2" (click)="addTimeSlot()">+ Add Another Slot</button>
                    </div>
                </div>

            </div>

            <!-- Buttons -->
            <div class="form-actions text-center mt-3">
                <button type="submit" class="btn btn-dark mx-2" [disabled]="slotForm.invalid">
                    Save
                </button>
                <!-- <button type="reset" class="btn btn-secondary mx-2" (click)="slotForm.reset()">
                    Reset
                </button> -->
            </div>
        </form>
    </div>
</div>