<div class="form-meta">
  <div class="header">
    <h2>OPERATION GORUP MASTER LIST</h2>
    <div class="">
      <!-- <button class="list-cases-btn mx-3"   ><i class="fa-solid fa-user-group"></i></button> -->
      <button
        class="list-cases-btn mx-3"
        [routerLink]="['/master/surgerypackagemaster']"
        routerLinkActive="router-link-active"
      >
        ADD SURGERY PACKAGE
      </button>
    </div>
  </div>
  <form [formGroup]="filterForm" class="top-bar p-3">
    <!-- <select formControlName="recordsPerPage">
      <option *ngFor="let num of [10, 25, 50, 100]" [value]="num">{{ num }} RECORDS</option>
    </select> -->

    <input type="text" placeholder="Search..." formControlName="searchText" />
  </form>

  <!-- <div class="loader-wrapper" *ngIf="surgery.length === 0">
    <div class="loader">
      <img src="Untitled design (6).jpg" alt="Loading..." class="loading-img" />
    </div>
  </div> -->

  <!-- Packages Table -->
  <div class="table-responsive">
    <table
      class="table table-bordered table-hover align-middle diagnosis-table"
    >
      <thead class="table-dark">
        <tr>
          <th></th>
          <!-- Expand/Collapse column -->
          <th>Name</th>
          <th>Price</th>
          <th>Duration (Days)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let pkg of surgery; let i = index">
          <!-- Main Row -->
          <tr (click)="toggleExpansion(i)">
            <td>
              {{ i + 1 }}
            </td>
            <td>{{ pkg.name }}</td>
            <td>{{ pkg.totalPrice | indianCurrency }}</td>
            <td>{{ pkg.duration }} days</td>
            <td>
              <i
                class="fa-solid fa-pencil action-btn mx-3"
                *ngIf="userPermissions.update"
                (click)="editSurgery(pkg._id)"
                style="cursor: pointer"
              ></i>
            </td>
          </tr>

          <!-- Expandable Row for Room-wise Breakdown -->
          <tr
            *ngIf="
              pkg.expanded &&
              pkg.roomWiseBreakdown &&
              pkg.roomWiseBreakdown.length > 0
            "
          >
            <td colspan="5" class="p-0">
              <div class="bg-light p-3">
                <h6 class="mb-3 text-primary">Room-wise Charges Breakdown</h6>
                <div class="table-responsive">
                  <table class="table table-sm table-striped mb-0">
                    <thead class="table-secondary">
                      <tr>
                        <th>Room Type</th>
                        <th>Room Description</th>
                        <!-- <th>Daily Room Rate</th> -->
                        <th>Package Price for this Room</th>
                        <th>Duration</th>
                        <!-- <th>Estimated Total</th> -->
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let room of pkg.roomWiseBreakdown">
                        <td>
                          <span class="badge bg-info">{{ room.roomName }}</span>
                        </td>
                        <td>
                          <small class="text-muted">{{
                            room.roomDescription
                          }}</small>
                        </td>
                        <!-- <td>{{room.roomPrice | indianCurrency}}/day</td> -->
                        <td>
                          <strong>{{
                            room.packagePrice | indianCurrency
                          }}</strong>
                        </td>
                        <td>{{ pkg.duration }} days</td>
                        <!-- <td>
                <span class="badge bg-success">
                  {{room.packagePrice | indianCurrency}}
                </span>
              </td> -->
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Optional: Add a summary row if multiple room types -->
                <div class="mt-3" *ngIf="pkg.roomWiseBreakdown.length > 1">
                  <div class="row">
                    <div class="col-md-8 text-end">
                      <strong>Available Room Options Total Range:</strong>
                    </div>
                    <div class="col-md-4">
                      <span class="badge bg-primary fs-6">
                        {{
                          getMinPackagePrice(pkg.roomWiseBreakdown)
                            | indianCurrency
                        }}
                        -
                        {{
                          getMaxPackagePrice(pkg.roomWiseBreakdown)
                            | indianCurrency
                        }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
  <!-- Add this above your table -->
  <!-- <div class="d-flex justify-content-end mb-3">
  <button class="btn btn-sm btn-outline-primary me-2" (click)="expandAll()">
    <i class="fa-solid fa-expand-alt"></i> Expand All
  </button>
  <button class="btn btn-sm btn-outline-secondary" (click)="collapseAll()">
    <i class="fa-solid fa-compress-alt"></i> Collapse All
  </button>
</div> -->
  <div class="pagination">
    <button
      class="pagination-btn"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>
    Page {{ currentPage }} of {{ totalPages }}
    <button
      class="pagination-btn"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>
</div>
